<!DOCTYPE html>
<html lang="{{ page.lang | default: site.lang | default: 'en-US' }}">
  <head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">

{% seo title=false %}
    {% assign page_filename = page.path | split: '/' | last %}
    {% assign page_base_name = page_filename | split: '.' | first %}
    {% assign page_parts = page_base_name | split: ' ' %}
    {% assign page_first = page_parts | first %}
    {% assign page_first_as_num_str = page_first | plus: 0 | append: '' %}
    {% assign page_display_title = page_base_name %}
    {% if page_parts.size > 1 and page_first == page_first_as_num_str %}
      {% assign page_display_title = page_base_name | remove_first: page_first | remove_first: ' ' %}
    {% endif %}
    <title>{{ page_display_title }}{% if site.title and site.title != page_display_title %} | {{ site.title }}{% endif %}</title>
    <link rel="stylesheet" href="{{ "/assets/css/style.css?v=" | append: site.github.build_revision | relative_url }}">
    <link rel="stylesheet" href="{{ "/assets/css/custom.css?v=" | append: site.github.build_revision | relative_url }}">
    {% include head-custom.html %}
  </head>

  <body>
    {% assign all_md_pages = site.pages
      | where_exp: "p", "p.path contains '.md'"
      | sort_natural: "path" %}

    {% if page.path contains '/' %}
      {% assign active_section_dir = page.path | split: '/' | first %}
    {% else %}
      {% assign active_section_dir = "" %}
    {% endif %}

    {% assign section_dirs_tokens = "" %}
    {% for p in all_md_pages %}
      {% if p.path contains '/' %}
        {% assign section_dir = p.path | split: '/' | first %}
        {% assign token = '|' | append: section_dir | append: '|' %}
        {% unless section_dirs_tokens contains token %}
          {% assign section_dirs_tokens = section_dirs_tokens | append: token %}
        {% endunless %}
      {% endif %}
    {% endfor %}
    {% assign section_dirs = section_dirs_tokens | split: '|' | sort_natural %}

    {% assign home_page = all_md_pages | where: "url", "/" | first %}
    {% if home_page %}
      {% assign home_filename = home_page.path | split: '/' | last %}
      {% if home_filename == "README.md" %}
        {% assign home_display_title = "Cilia" %}
      {% else %}
        {% assign home_display_title = home_filename | split: '.' | first %}
      {% endif %}
    {% else %}
      {% assign home_display_title = "Home" %}
    {% endif %}

    <nav
      aria-label="Primary"
    >
      <ul class="nav-main">
        {% if home_page %}
          <li>
            <a
              href="{{ home_page.url | relative_url }}"
              {% if home_page.url == page.url %}aria-current="page"{% endif %}
            >{{ home_display_title }}</a>
          </li>
        {% endif %}

        {% for p in all_md_pages %}
          {% unless p.path contains '/' %}
            {% if home_page == nil or p.url != home_page.url %}
              {% assign p_filename = p.path | split: '/' | last %}
              {% assign p_base_name = p_filename | split: '.' | first %}
              {% assign p_parts = p_base_name | split: ' ' %}
              {% assign p_first = p_parts | first %}
              {% assign p_first_as_num_str = p_first | plus: 0 | append: '' %}
              {% assign p_display_title = p_base_name %}
              {% if p_parts.size > 1 and p_first == p_first_as_num_str %}
                {% assign p_display_title = p_base_name | remove_first: p_first | remove_first: ' ' %}
              {% endif %}
              <li>
                <a
                  href="{{ p.url | relative_url }}"
                  {% if p.url == page.url %}aria-current="page"{% endif %}
                >{{ p_display_title }}</a>
              </li>
            {% endif %}
          {% endunless %}
        {% endfor %}

        {% for section_dir in section_dirs %}
          {% if section_dir != "" %}
            {% assign section_parts = section_dir | split: ' ' %}
            {% assign section_first = section_parts | first %}
            {% assign section_first_as_num_str = section_first | plus: 0 | append: '' %}
            {% assign section_display_title = section_dir %}
            {% if section_parts.size > 1 and section_first == section_first_as_num_str %}
              {% assign section_display_title = section_dir | remove_first: section_first | remove_first: ' ' %}
            {% endif %}

            {% assign section_prefix = section_dir | append: '/' %}
            {% assign section_pages = all_md_pages
              | where_exp: "p", "p.path contains section_prefix"
              | sort_natural: "path" %}

            {% assign section_index_page = "" %}
            {% assign section_index_url = "" %}
            {% assign section_has_index_md = false %}

            {% for p in section_pages %}
              {% assign p_filename = p.path | split: '/' | last %}
              {% if p_filename == "Index.md" %}
                {% assign section_index_page = p %}
                {% assign section_index_url = p.url %}
                {% assign section_has_index_md = true %}
                {% break %}
              {% endif %}
            {% endfor %}

            {% if section_index_page == "" %}
              {% assign section_index_page = section_pages | first %}
              {% if section_index_page %}
                {% assign section_index_url = section_index_page.url %}
              {% endif %}
            {% endif %}

            <li>
              <a
                href="{{ section_index_url | relative_url }}"
                {% if section_dir == active_section_dir %}
                  {% if section_index_url == page.url %}
                    aria-current="page"
                  {% else %}
                    aria-current="location"
                  {% endif %}
                {% endif %}
              >{{ section_display_title }}</a>

              {% if section_dir == active_section_dir %}
                {% assign submenu_item_count = 0 %}
                {% for c in section_pages %}
                  {% assign c_filename = c.path | split: '/' | last %}
                  {% if c_filename != "Index.md" %}
                    {% assign submenu_item_count = submenu_item_count | plus: 1 %}
                  {% endif %}
                {% endfor %}

                {% if section_has_index_md %}
                  {% if submenu_item_count > 0 %}
                    <ul class="nav-sub" aria-label="{{ section_display_title }} sub-pages">
                      {% for c in section_pages %}
                        {% assign c_filename = c.path | split: '/' | last %}
                        {% if c_filename != "Index.md" %}
                          {% assign c_base_name = c_filename | split: '.' | first %}
                          {% assign c_parts = c_base_name | split: ' ' %}
                          {% assign c_first = c_parts | first %}
                          {% assign c_first_as_num_str = c_first | plus: 0 | append: '' %}
                          {% assign c_display_title = c_base_name %}
                          {% if c_parts.size > 1 and c_first == c_first_as_num_str %}
                            {% assign c_display_title = c_base_name | remove_first: c_first | remove_first: ' ' %}
                          {% endif %}
                          <li>
                            <a
                              href="{{ c.url | relative_url }}"
                              {% if c.url == page.url %}aria-current="page"{% endif %}
                            >{{ c_display_title }}</a>
                          </li>
                        {% endif %}
                      {% endfor %}
                    </ul>
                  {% endif %}
                {% else %}
                  {% if submenu_item_count > 1 %}
                    <ul class="nav-sub" aria-label="{{ section_display_title }} sub-pages">
                      {% for c in section_pages %}
                        {% assign c_filename = c.path | split: '/' | last %}
                        {% if c_filename != "Index.md" %}
                          {% assign c_base_name = c_filename | split: '.' | first %}
                          {% assign c_parts = c_base_name | split: ' ' %}
                          {% assign c_first = c_parts | first %}
                          {% assign c_first_as_num_str = c_first | plus: 0 | append: '' %}
                          {% assign c_display_title = c_base_name %}
                          {% if c_parts.size > 1 and c_first == c_first_as_num_str %}
                            {% assign c_display_title = c_base_name | remove_first: c_first | remove_first: ' ' %}
                          {% endif %}
                          <li>
                            <a
                              href="{{ c.url | relative_url }}"
                              {% if c.url == page.url %}aria-current="page"{% endif %}
                            >{{ c_display_title }}</a>
                          </li>
                        {% endif %}
                      {% endfor %}
                    </ul>
                  {% endif %}
                {% endif %}
              {% endif %}
            </li>
          {% endif %}
        {% endfor %}
      </ul>
    </nav>

    <div class="container-lg px-3 my-5 markdown-body">
      <main>
        {{ content }}
      </main>

      <footer>
        <div class="footer border-top border-gray-light mt-5 pt-3 text-right text-gray">
          Â© 2024-2026 Lars Rosenboom, licensed under <a href="/LICENSE.txt">CC-BY-NC-ND-4.0</a>
        </div>
      </footer>
    </div>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/anchor-js/4.1.0/anchor.min.js" integrity="sha256-lZaRhKri35AyJSypXXs4o6OPFTbTmUoltBbDCbdzegg=" crossorigin="anonymous"></script>
    <script>anchors.add();</script>
  </body>
</html>
