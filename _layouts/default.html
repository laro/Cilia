<!DOCTYPE html>
{% comment %}
  Layout: default

  Responsibilities
  - Render a consistent page chrome (primary navigation, optional section sub-nav, footer).
  - Compute a good HTML <title> from page content / file structure.
  - Provide keyboard navigation (Left/Right arrows) based on <link rel="prev|next">.
  - Add heading anchor links via AnchorJS.

  Content conventions used by this layout
  - Documentation pages are Markdown files (.md) in the repository.
  - Section folders may be prefixed with numbers (e.g. "1 Basics/"); the numeric prefix is
    stripped from navigation labels.
  - Section index pages are expected to be named "0 Index.md" / "00 Index.md" (preferred) or "Index.md";
    when not present, the first page in the section is used as the section landing page.
{% endcomment %}
<html lang="{{ page.lang | default: site.lang | default: 'en-US' }}">
  <head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">

{% seo title=false %}
    {% comment %}
      Key navigation ("keynav")
      - Determines prev/next pages in a linear order (sorted by path).
      - Exposes them as <link rel="prev|next"> in the <head>.
      - The script at the bottom uses these link tags for ArrowLeft/ArrowRight navigation.
    {% endcomment %}
    {% assign all_md_pages_for_keynav = site.pages
      | where_exp: "p", "p.path contains '.md'"
      | sort_natural: "path" %}

    {% comment %}
      Determine the canonical "home" URL.
      Notes:
      - Jekyll's home page is typically README.md (url "/"), but this keeps it flexible.
    {% endcomment %}
    {% assign keynav_home_url = "/" %}
    {% assign keynav_home_page = all_md_pages_for_keynav | where: "url", "/" | first %}
    {% if keynav_home_page %}
      {% assign keynav_home_url = keynav_home_page.url %}
    {% endif %}

    {% comment %}
      Build the linear sequence used for prev/next:
      - Home is excluded from the linear sequence so we can special-case it below.
    {% endcomment %}
    {% assign keynav_linear_pages = all_md_pages_for_keynav
      | where_exp: "p", "p.url != keynav_home_url" %}

    {% comment %}
      Find prev/next by scanning the linear list in order.
      Once the current page is found, the next iteration's page becomes "next".
    {% endcomment %}
    {% assign keynav_prev_url = nil %}
    {% assign keynav_next_url = nil %}
    {% assign keynav_prev_page = nil %}
    {% assign keynav_found_current = false %}
    {% for p in keynav_linear_pages %}
      {% if keynav_found_current %}
        {% assign keynav_next_url = p.url %}
        {% break %}
      {% endif %}
      {% if p.url == page.url %}
        {% if keynav_prev_page %}
          {% assign keynav_prev_url = keynav_prev_page.url %}
        {% endif %}
        {% assign keynav_found_current = true %}
      {% endif %}
      {% assign keynav_prev_page = p %}
    {% endfor %}

    {% comment %}
      Identify the first section's landing page so we can connect Home -> first section.
      We prefer "0 Index.md" / "00 Index.md" / "Index.md" inside that first section; otherwise we fall back
      to that section's first page.
    {% endcomment %}
    {% assign keynav_first_section_index_url = "" %}
    {% assign keynav_first_section_dir = "" %}
    {% assign keynav_first_section_first_page = nil %}
    {% for p in all_md_pages_for_keynav %}
      {% if p.path contains '/' %}
        {% assign keynav_first_section_dir = p.path | split: '/' | first %}
        {% assign keynav_first_section_first_page = p %}
        {% break %}
      {% endif %}
    {% endfor %}

    {% if keynav_first_section_dir != "" %}
      {% assign keynav_first_section_prefix = keynav_first_section_dir | append: '/' %}

      {% for p in all_md_pages_for_keynav %}
        {% if p.path contains keynav_first_section_prefix %}
          {% assign p_filename = p.path | split: '/' | last %}
          {% if p_filename == "0 Index.md" or p_filename == "00 Index.md" or p_filename == "Index.md" %}
            {% assign keynav_first_section_index_url = p.url %}
            {% break %}
          {% endif %}
        {% endif %}
      {% endfor %}
    {% endif %}

    {% if keynav_first_section_index_url == "" and keynav_first_section_first_page %}
      {% assign keynav_first_section_index_url = keynav_first_section_first_page.url %}
    {% endif %}

    {% comment %}
      Keynav special-cases:
      - Home's "next" should point at the first section landing page.
      - The first section landing page's "prev" should point back to Home.
    {% endcomment %}
    {% if page.url == keynav_home_url and keynav_first_section_index_url != "" %}
      {% assign keynav_prev_url = nil %}
      {% assign keynav_next_url = keynav_first_section_index_url %}
    {% elsif page.url == keynav_first_section_index_url and keynav_home_url != "" %}
      {% assign keynav_prev_url = keynav_home_url %}
    {% endif %}

    {% comment %}
      Human-friendly page title derived from filename.
      - If the filename starts with a numeric prefix (e.g. "7 Literals.md"), strip the prefix.
    {% endcomment %}
    {% assign page_filename = page.path | split: '/' | last %}
    {% assign page_base_name = page_filename | split: '.' | first %}
    {% assign page_parts = page_base_name | split: ' ' %}
    {% assign page_first = page_parts | first %}
    {% assign page_first_non_digits = page_first
      | remove: '0'
      | remove: '1'
      | remove: '2'
      | remove: '3'
      | remove: '4'
      | remove: '5'
      | remove: '6'
      | remove: '7'
      | remove: '8'
      | remove: '9' %}
    {% assign page_display_title = page_base_name %}
    {% if page_parts.size > 1 and page_first_non_digits == '' and page_first != '' %}
      {% assign page_display_title = page_base_name | remove_first: page_first | remove_first: ' ' %}
    {% endif %}

    {% comment %}
      HTML <title> computation strategy:
      - Base fallback title is derived from file name (see above).
      - README.md becomes the site title (or "Home") to avoid showing "README".
      - Index pages ("0 Index.md" / "00 Index.md" / "Index.md") show the section name (or site title).
      - Prefer the first rendered heading (H1, then H2) from the page content, but avoid
        generic headings like "README" or "Index".
    {% endcomment %}

    {% comment %}
      Human-friendly section title derived from section directory.
      - If the directory starts with a numeric prefix (e.g. "2 Standard Lib"), strip it.
    {% endcomment %}
    {% assign section_dir = "" %}
    {% if page.path contains '/' %}
      {% assign section_dir = page.path | split: '/' | first %}
    {% endif %}
    {% assign section_parts = section_dir | split: ' ' %}
    {% assign section_first = section_parts | first %}
    {% assign section_first_non_digits = section_first
      | remove: '0'
      | remove: '1'
      | remove: '2'
      | remove: '3'
      | remove: '4'
      | remove: '5'
      | remove: '6'
      | remove: '7'
      | remove: '8'
      | remove: '9' %}
    {% assign section_display_title = section_dir %}
    {% if section_parts.size > 1 and section_first_non_digits == '' and section_first != '' %}
      {% assign section_display_title = section_dir | remove_first: section_first | remove_first: ' ' %}
    {% endif %}

    {% assign fallback_title = page_display_title %}
    {% if page_filename == "README.md" %}
      {% assign fallback_title = site.title | default: "Home" %}
    {% elsif page_filename == "0 Index.md" or page_filename == "00 Index.md" or page_filename == "Index.md" %}
      {% if section_display_title != "" %}
        {% assign fallback_title = section_display_title %}
      {% else %}
        {% assign fallback_title = site.title | default: "Home" %}
      {% endif %}
    {% endif %}

    {% assign heading_title = "" %}

    {% if content contains "<h1" %}
      {% assign h1_after = content | split: "<h1" | slice: 1 %}
      {% if h1_after %}
        {% assign h1_tag_and_inner = h1_after | split: "</h1>" | first %}
        {% assign h1_parts = h1_tag_and_inner | split: ">" %}
        {% assign h1_inner_html = h1_parts | slice: 1, 999 | join: ">" %}
        {% assign heading_title = h1_inner_html | strip_html | strip %}
      {% endif %}
    {% endif %}

    {% if heading_title == "" and content contains "<h2" %}
      {% assign h2_after = content | split: "<h2" | slice: 1 %}
      {% if h2_after %}
        {% assign h2_tag_and_inner = h2_after | split: "</h2>" | first %}
        {% assign h2_parts = h2_tag_and_inner | split: ">" %}
        {% assign h2_inner_html = h2_parts | slice: 1, 999 | join: ">" %}
        {% assign heading_title = h2_inner_html | strip_html | strip %}
      {% endif %}
    {% endif %}

    {% assign final_title = fallback_title %}
    {% assign heading_title_down = heading_title | downcase %}
    {% if heading_title != "" and heading_title_down != "readme" and heading_title_down != "index" %}
      {% assign final_title = heading_title %}
    {% endif %}

    <title>{{ final_title }}{% if site.title and site.title != final_title %} | {{ site.title }}{% endif %}</title>
    <link rel="stylesheet" href="{{ "/assets/css/style.css?v=" | append: site.github.build_revision | relative_url }}">
    <link rel="stylesheet" href="{{ "/assets/css/custom.css?v=" | append: site.github.build_revision | relative_url }}">
    {% comment %}
      These are used by the keyboard navigation script (ArrowLeft/ArrowRight).
      They are also meaningful to crawlers and some browsers.
    {% endcomment %}
    {% if keynav_prev_url %}<link rel="prev" href="{{ keynav_prev_url | relative_url }}">{% endif %}
    {% if keynav_next_url %}<link rel="next" href="{{ keynav_next_url | relative_url }}">{% endif %}
    {% include head-custom.html %}
  </head>

  <body>
    {% comment %}
      Navigation model:
      - all_md_pages: all Markdown pages sorted by path.
      - section_dirs: unique top-level directories (built via token string because Liquid
        doesn't have a native "set").
      - active_section_dir: the current top-level directory, used for sub-navigation.
    {% endcomment %}
    {% assign all_md_pages = site.pages
      | where_exp: "p", "p.path contains '.md'"
      | sort_natural: "path" %}

    {% if page.path contains '/' %}
      {% assign active_section_dir = page.path | split: '/' | first %}
    {% else %}
      {% assign active_section_dir = "" %}
    {% endif %}

    {% assign section_dirs_tokens = "" %}
    {% for p in all_md_pages %}
      {% if p.path contains '/' %}
        {% assign section_dir = p.path | split: '/' | first %}
        {% assign token = '|' | append: section_dir | append: '|' %}
        {% unless section_dirs_tokens contains token %}
          {% assign section_dirs_tokens = section_dirs_tokens | append: token %}
        {% endunless %}
      {% endif %}
    {% endfor %}
    {% assign section_dirs = section_dirs_tokens | split: '|' | sort_natural %}

    {% comment %}
      Home link label:
      - If the home page is README.md, display a friendly project name ("Cilia").
      - Otherwise, derive it from the file name.
    {% endcomment %}
    {% assign home_page = all_md_pages | where: "url", "/" | first %}
    {% if home_page %}
      {% assign home_filename = home_page.path | split: '/' | last %}
      {% if home_filename == "README.md" %}
        {% assign home_display_title = "Cilia" %}
      {% else %}
        {% assign home_display_title = home_filename | split: '.' | first %}
      {% endif %}
    {% else %}
      {% assign home_display_title = "Home" %}
    {% endif %}

    {% assign has_active_subnav = false %}
    {% assign active_section_index_url = "" %}
    {% if active_section_dir != "" %}
      {% assign active_prefix = active_section_dir | append: '/' %}
      {% assign active_section_pages = all_md_pages
        | where_exp: "p", "p.path contains active_prefix"
        | sort_natural: "path" %}

      {% comment %}
        Active section landing page:
        - Prefer "0 Index.md" / "00 Index.md", otherwise the first page in the section.
        - The landing page itself is excluded from the sub-nav list.
      {% endcomment %}
      {% assign active_section_index_page = "" %}
      {% for p in active_section_pages %}
        {% assign p_filename = p.path | split: '/' | last %}
        {% if p_filename == "0 Index.md" or p_filename == "00 Index.md" %}
          {% assign active_section_index_page = p %}
          {% assign active_section_index_url = p.url %}
          {% break %}
        {% endif %}
      {% endfor %}
      {% if active_section_index_page == "" %}
        {% assign active_section_index_page = active_section_pages | first %}
        {% if active_section_index_page %}
          {% assign active_section_index_url = active_section_index_page.url %}
        {% endif %}
      {% endif %}

      {% assign active_submenu_item_count = 0 %}
      {% for p in active_section_pages %}
        {% assign p_filename = p.path | split: '/' | last %}
        {% if p_filename != "0 Index.md" and p_filename != "00 Index.md" %}
          {% assign active_submenu_item_count = active_submenu_item_count | plus: 1 %}
        {% endif %}
      {% endfor %}
      {% if active_submenu_item_count > 0 %}
        {% assign has_active_subnav = true %}
      {% endif %}
    {% endif %}

    <nav aria-label="Primary">
      {% comment %}
        Primary navigation:
        - Home
        - Top-level (root) Markdown pages (not in a directory)
        - One entry per section directory (links to its landing page)
      {% endcomment %}
      {% comment %}
        Site search:
        - This is a simple redirect form to DuckDuckGo/Google (no API keys).
        - We default to searching within the configured site.url via a `site:` prefix.
      {% endcomment %}
      {% assign search_site_host = site.url
        | default: ""
        | replace: "https://", ""
        | replace: "http://", ""
        | split: "/"
        | first %}
      <ul class="nav-main">
        {% if home_page %}
          <li>
            <a
              href="{{ home_page.url | relative_url }}"
              {% if home_page.url == page.url %}aria-current="page"{% endif %}
            >{{ home_display_title }}</a>
          </li>
        {% endif %}

        {% for p in all_md_pages %}
          {% unless p.path contains '/' %}
            {% if home_page == nil or p.url != home_page.url %}
              {% assign p_filename = p.path | split: '/' | last %}
              {% assign p_base_name = p_filename | split: '.' | first %}
              {% assign p_parts = p_base_name | split: ' ' %}
              {% assign p_first = p_parts | first %}
              {% assign p_first_non_digits = p_first
                | remove: '0'
                | remove: '1'
                | remove: '2'
                | remove: '3'
                | remove: '4'
                | remove: '5'
                | remove: '6'
                | remove: '7'
                | remove: '8'
                | remove: '9' %}
              {% assign p_display_title = p_base_name %}
              {% if p_parts.size > 1 and p_first_non_digits == '' and p_first != '' %}
                {% assign p_display_title = p_base_name | remove_first: p_first | remove_first: ' ' %}
              {% endif %}
              <li>
                <a
                  href="{{ p.url | relative_url }}"
                  {% if p.url == page.url %}aria-current="page"{% endif %}
                >{{ p_display_title }}</a>
              </li>
            {% endif %}
          {% endunless %}
        {% endfor %}

        {% for section_dir in section_dirs %}
          {% if section_dir != "" %}
            {% comment %}
              Section label and landing link:
              - Strip numeric prefix from the directory label, same as for page titles.
              - Prefer "0 Index.md" / "00 Index.md" as section index, otherwise first page.
              - aria-current="location" marks the active section while browsing inside it.
            {% endcomment %}
            {% assign section_parts = section_dir | split: ' ' %}
            {% assign section_first = section_parts | first %}
            {% assign section_first_non_digits = section_first
              | remove: '0'
              | remove: '1'
              | remove: '2'
              | remove: '3'
              | remove: '4'
              | remove: '5'
              | remove: '6'
              | remove: '7'
              | remove: '8'
              | remove: '9' %}
            {% assign section_display_title = section_dir %}
            {% if section_parts.size > 1 and section_first_non_digits == '' and section_first != '' %}
              {% assign section_display_title = section_dir | remove_first: section_first | remove_first: ' ' %}
            {% endif %}

            {% assign section_prefix = section_dir | append: '/' %}
            {% assign section_pages = all_md_pages
              | where_exp: "p", "p.path contains section_prefix"
              | sort_natural: "path" %}

            {% assign section_index_page = "" %}
            {% assign section_index_url = "" %}
            {% assign section_has_index_md = false %}

            {% for p in section_pages %}
              {% assign p_filename = p.path | split: '/' | last %}
              {% if p_filename == "0 Index.md" or p_filename == "00 Index.md" %}
                {% assign section_index_page = p %}
                {% assign section_index_url = p.url %}
                {% assign section_has_index_md = true %}
                {% break %}
              {% endif %}
            {% endfor %}

            {% if section_index_page == "" %}
              {% assign section_index_page = section_pages | first %}
              {% if section_index_page %}
                {% assign section_index_url = section_index_page.url %}
              {% endif %}
            {% endif %}

            <li>
              <a
                href="{{ section_index_url | relative_url }}"
                {% if section_dir == active_section_dir %}
                  {% if section_index_url == page.url %}
                    aria-current="page"
                  {% else %}
                    aria-current="location"
                  {% endif %}
                {% endif %}
              >{{ section_display_title }}</a>
            </li>
          {% endif %}
        {% endfor %}

        <li class="nav-search-item">
          <form
            class="nav-search nav-search--inline"
            id="navSearch"
            action="https://www.google.com/search"
            method="get"
            role="search"
            aria-label="Search this site"
            data-site="{{ search_site_host }}"
          >
            <label class="sr-only" for="navSearchInput">Search</label>
            <input
              id="navSearchInput"
              class="nav-search-input"
              type="search"
              placeholder="Search…"
              autocomplete="off"
              spellcheck="false"
            >
            <input type="hidden" id="navSearchQuery" name="q" value="">
          </form>
        </li>
      </ul>

      {% if has_active_subnav %}
        {% comment %}
          Sub-navigation for the active section:
          - Lists all pages in the active section except "0 Index.md" / "00 Index.md" (the landing page).
          - Uses aria-current="page" for the current page.
        {% endcomment %}
        {% assign active_section_display_title = active_section_dir %}
        {% assign active_section_parts = active_section_dir | split: ' ' %}
        {% assign active_section_first = active_section_parts | first %}
        {% assign active_section_first_non_digits = active_section_first
          | remove: '0'
          | remove: '1'
          | remove: '2'
          | remove: '3'
          | remove: '4'
          | remove: '5'
          | remove: '6'
          | remove: '7'
          | remove: '8'
          | remove: '9' %}
        {% if active_section_parts.size > 1 and active_section_first_non_digits == '' and active_section_first != '' %}
          {% assign active_section_display_title = active_section_dir | remove_first: active_section_first | remove_first: ' ' %}
        {% endif %}

        <ul class="nav-sub" aria-label="{{ active_section_display_title }} sub-pages">
          {% for c in active_section_pages %}
            {% assign c_filename = c.path | split: '/' | last %}
            {% if c_filename != "0 Index.md" and c_filename != "00 Index.md" %}
              {% assign c_base_name = c_filename | split: '.' | first %}
              {% assign c_parts = c_base_name | split: ' ' %}
              {% assign c_first = c_parts | first %}
              {% assign c_first_non_digits = c_first
                | remove: '0'
                | remove: '1'
                | remove: '2'
                | remove: '3'
                | remove: '4'
                | remove: '5'
                | remove: '6'
                | remove: '7'
                | remove: '8'
                | remove: '9' %}
              {% assign c_display_title = c_base_name %}
              {% if c_parts.size > 1 and c_first_non_digits == '' and c_first != '' %}
                {% assign c_display_title = c_base_name | remove_first: c_first | remove_first: ' ' %}
              {% endif %}
              <li>
                <a
                  href="{{ c.url | relative_url }}"
                  {% if c.url == page.url %}aria-current="page"{% endif %}
                >{{ c_display_title }}</a>
              </li>
            {% endif %}
          {% endfor %}
        </ul>
      {% endif %}
    </nav>

    <div class="container-lg px-3 my-5 markdown-body">
      <main>
        {{ content }}
      </main>

      <footer>
        <div class="footer mt-5 pt-3 text-center text-gray">
          © 2024-2026 Lars Rosenboom, licensed under <a href="/LICENSE.txt">CC-BY-NC-ND-4.0</a>
        </div>
      </footer>
    </div>
    {% comment %}
      Anchor links for headings:
      - AnchorJS scans headings and inserts linkable anchors.
    {% endcomment %}
    <script src="https://cdnjs.cloudflare.com/ajax/libs/anchor-js/4.1.0/anchor.min.js" integrity="sha256-lZaRhKri35AyJSypXXs4o6OPFTbTmUoltBbDCbdzegg=" crossorigin="anonymous"></script>
    <script>anchors.add();</script>
    <script>
      // Keyboard navigation:
      // - ArrowLeft navigates to <link rel="prev"> if present.
      // - ArrowRight navigates to <link rel="next"> if present.
      // - "s" focuses the search input.
      // - Escape leaves the search input and restores window focus.
      // - Disabled while typing in inputs/textarea/select or contenteditable elements.
      (function () {
        function isTypingContext(el) {
          if (!el) return false;
          if (el.isContentEditable) return true;
          var tag = (el.tagName || "").toLowerCase();
          return tag === "input" || tag === "textarea" || tag === "select";
        }

        function navigateRel(rel) {
          var link = document.querySelector('link[rel="' + rel + '"]');
          if (!link || !link.href) return false;
          window.location.href = link.href;
          return true;
        }

        function focusSearchInput() {
          var searchInput = document.getElementById("navSearchInput");
          if (!searchInput) return false;
          searchInput.focus();
          searchInput.select();
          return true;
        }

        function blurSearchInput() {
          var searchInput = document.getElementById("navSearchInput");
          if (!searchInput) return false;
          if (document.activeElement !== searchInput) return false;
          searchInput.value = "";
          var hiddenQuery = document.getElementById("navSearchQuery");
          if (hiddenQuery) hiddenQuery.value = "";
          searchInput.blur();
          window.focus();
          return true;
        }

        // Swipe navigation (mobile):
        // - Swipe right -> prev, swipe left -> next.
        // - Avoids triggering during vertical scrolling.
        // - Ignores edge swipes to avoid fighting Safari back/forward gestures.
        var touchStartX = 0;
        var touchStartY = 0;
        var touchStartTime = 0;
        var touchActive = false;

        function isNearEdge(x) {
          var edgePx = 24;
          return x <= edgePx || x >= (window.innerWidth - edgePx);
        }

        document.addEventListener(
          "touchstart",
          function (e) {
            if (!e.touches || e.touches.length !== 1) return;
            if (isTypingContext(document.activeElement)) return;
            if (isTypingContext(e.target)) return;

            var t = e.touches[0];
            if (!t) return;
            if (isNearEdge(t.clientX)) return;

            touchStartX = t.clientX;
            touchStartY = t.clientY;
            touchStartTime = Date.now();
            touchActive = true;
          },
          { passive: true }
        );

        document.addEventListener(
          "touchend",
          function (e) {
            if (!touchActive) return;
            touchActive = false;

            if (!e.changedTouches || e.changedTouches.length !== 1) return;
            if (isTypingContext(document.activeElement)) return;
            if (isTypingContext(e.target)) return;

            var t = e.changedTouches[0];
            if (!t) return;

            var dx = t.clientX - touchStartX;
            var dy = t.clientY - touchStartY;
            var dt = Date.now() - touchStartTime;

            // Heuristics tuned to avoid accidental navigation while scrolling.
            var minDx = 80;
            var maxDy = 50;
            var maxDt = 600;

            if (dt > maxDt) return;
            if (Math.abs(dx) < minDx) return;
            if (Math.abs(dy) > maxDy) return;
            if (Math.abs(dx) < Math.abs(dy) * 1.5) return;

            if (dx > 0) {
              // Swipe right: go to previous page.
              if (navigateRel("prev")) e.preventDefault();
            } else {
              // Swipe left: go to next page.
              if (navigateRel("next")) e.preventDefault();
            }
          },
          { passive: false }
        );

        document.addEventListener("keydown", function (e) {
          if (e.defaultPrevented) return;
          if (e.altKey || e.ctrlKey || e.metaKey) return;

          var key = (e.key || "").toLowerCase();
          if (key === "escape") {
            if (blurSearchInput()) e.preventDefault();
            return;
          }

          if (isTypingContext(document.activeElement)) return;

          if (key === "arrowleft") {
            if (navigateRel("prev")) e.preventDefault();
          } else if (key === "arrowright") {
            if (navigateRel("next")) e.preventDefault();
          } else if (key === "s") {
            if (focusSearchInput()) e.preventDefault();
          }
        });
      })();
    </script>
    <script>
      // Search box behavior:
      // - Redirects to Google.
      // - Sends the query through a hidden `q` field.
      // - Prefixes with `site:<host>` unless the query already contains "site:".
      // - Keeps the visible text input unchanged.
      (function () {
        var form = document.getElementById("navSearch");
        if (!form) return;

        var input = document.getElementById("navSearchInput");
        if (!input) return;

        var hiddenQuery = document.getElementById("navSearchQuery");
        if (!hiddenQuery) return;

        form.addEventListener("submit", function () {
          var q = (input.value || "").trim();
          if (!q) return;

          var submitQuery = q;

          // Only scope to the site if we have a host configured.
          var siteHost = (form.getAttribute("data-site") || "").trim();
          if (siteHost && !/(\s|^)site:/i.test(q)) {
            submitQuery = "site:" + siteHost + " " + q;
          }

          hiddenQuery.value = submitQuery;
        });
      })();
    </script>
  </body>
</html>
